define(['jquery', 'core/ajax'],
    function ($, ajax) {
        return {
            razorpay_payment: function (pluginname, user_id, razorpaykeyid, razorpaykeysecret, instance_id, please_wait_string, buy_now_string) {
                // free enrol js
                var get_card_zero_cost = $('#card-button-zero');
                if (get_card_zero_cost) {
                    get_card_zero_cost.click(function () {
                        var promises = ajax.call([{
                            methodname: 'moodle_razorpaypayment_free_enrolsettings',
                            args: { user_id:user_id, instance_id: instance_id },
                        }]);
                        promises[0].then(function (data) {
                            location.reload();
                        }).fail(function (ex) {
                            location.reload();
                        });
                    });
                }
                // free enrol js
                var buyBtn = $('#payButton');
                var responseContainer = $('#paymentResponse');
                var handleResult = function (result) {
                    if (result.error) {
                        responseContainer.html('<p>' + result.error.message + '</p>');
                    }
                    buyBtn.prop('disabled', false);
                    buyBtn.text(buy_now_string);
                };
                //var stripe = Stripe(publishablekey);
                if (buyBtn) {
                    buyBtn.click(function () {
                        //buyBtn.prop('disabled', true);
                        //buyBtn.text(please_wait_string);
                        var promises = ajax.call([{
                            methodname: 'moodle_' + pluginname + '_razorpay_js_settings',
                            args: {user_id:user_id, instance_id: instance_id },
                        }]);
                        //console.log(promises);
                        promises[0].then(function (options) {
                            
                            var rzp = new Razorpay(options);
                            rzp.open();
                            console.log(options);
                            options.modal = {
                                ondismiss: function() {
                                    console.log("This code runs when the popup is closed");
                                },
                                // Boolean indicating whether pressing escape key 
                                // should close the checkout form. (default: true)
                                escape: true,
                                confirm_close: true,
                                // Boolean indicating whether clicking translucent blank
                                // space outside checkout form should close the form. (default: false)
                                backdropclose: true
                            };
                            /*if (data.status) {
                                console.log("yyyyy");
                            } else {
                                console.log("eeee");
                                //handleResult(data);
                            }*/
                        }).fail(function (ex) { // do something with the exception 
                            handleResult(ex);
                        });
                    });
                }
            }
        };
    });
